<!doctype html><meta charset=utf-8>

  <title>Sykkelstativer i Oslo</title>
  <link href="http://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="style.css" rel="stylesheet" type="text/css">

  <div id=app>
    <h1>Sykkelstativer i Oslo</h1>
    <table id=data>
      <tr> <th> Sykkelstativ <th> Ledige l√•ser <th> Ledige sykler
    </table>
    <div id=errors>Loading..</div>
  </div>

<script>
  const app = document.getElementById('app')
  const errors = document.getElementById('errors')
  // When calling this function, be sure to catch errors.
  // They include local network failure and server errors.
  async function fetchJSON(url) {
    const resp = await fetch(url)
    if (!resp.ok)
      throw Error(`${resp.status} ${resp.statusText}`)
    return resp.json()
  }
  async function main() {
    try {
      const stationInformation = await fetchJSON('https://gbfs.urbansharing.com/oslobysykkel.no/station_information.json')
      const stationStatus = await fetchJSON('https://gbfs.urbansharing.com/oslobysykkel.no/station_status.json')
      fillStationTable(stationInformation, stationStatus)
      errors.textContent = ''
    } catch(e) {
      errors.textContent = `Failed to fetch info from server. Maybe it will fix itself? Try again soon. ${e}.`
    }
  }

  function fillStationTable(stationInfoObj, stationStatusObj) {
      let stations = stationInfoObj['data']['stations']
      let stationStatus = stationStatusObj['data']['stations']
      let stationTable = document.getElementById('data')
      for (let i = 0; i < stations.length; i++) {
          let station = document.createElement('tr')

          // Assume stationInformation and stationStatus are sorted 
          // by station_id and contain the same stations.
          let stationName = document.createElement('td')
          stationName.textContent = stations[i].name
          station.appendChild(stationName)

          let stationNumDocks = document.createElement('td')
          stationNumDocks.textContent = stationStatus[i].num_docks_available
          station.appendChild(stationNumDocks)

          let stationNumBikes = document.createElement('td')
          stationNumBikes.textContent = stationStatus[i].num_bikes_available
          station.appendChild(stationNumBikes)

          stationTable.appendChild(station)
      }
      app.appendChild(stationTable)
  }

  main()
</script>
